Data Formats
============

This section describes the JSON data format used by svdep for storing and loading 
file dependency information.

JSON Schema
-----------

svdep uses a JSON format to persist file collection data between runs. This enables 
incremental builds by storing the dependency tree and timestamps from previous scans.

Top-Level Structure
~~~~~~~~~~~~~~~~~~~

.. code-block:: text

   {
     "root_files": [...],
     "file_info": {...}
   }

**Fields:**

- ``root_files``: Array of FileInfo objects for each root file.
- ``file_info``: Object mapping file paths to FileInfo objects for all files in the 
  dependency tree (including root files and all included files).

FileInfo Object
~~~~~~~~~~~~~~~

Each file in the collection is represented by a FileInfo object:

.. code-block:: json

   {
     "name": "/path/to/file.sv",
     "timestamp": 1699123456,
     "includes": ["/path/to/included.svh", "/path/to/other.svh"]
   }

**Fields:**

- ``name`` (string): Absolute path to the file.
- ``timestamp`` (integer): File modification time as Unix epoch timestamp (seconds since 
  January 1, 1970).
- ``includes`` (array of strings): List of absolute paths to files included by this file 
  via ``\`include`` directives.

Complete Example
----------------

Here is a complete example of a file collection JSON:

.. code-block:: json

   {
     "root_files": [
       {
         "name": "/project/rtl/top.sv",
         "timestamp": 1699123456,
         "includes": ["/project/rtl/include/defs.svh"]
       },
       {
         "name": "/project/rtl/dut.sv",
         "timestamp": 1699123400,
         "includes": [
           "/project/rtl/include/defs.svh",
           "/project/rtl/include/types.svh"
         ]
       }
     ],
     "file_info": {
       "/project/rtl/top.sv": {
         "name": "/project/rtl/top.sv",
         "timestamp": 1699123456,
         "includes": ["/project/rtl/include/defs.svh"]
       },
       "/project/rtl/dut.sv": {
         "name": "/project/rtl/dut.sv",
         "timestamp": 1699123400,
         "includes": [
           "/project/rtl/include/defs.svh",
           "/project/rtl/include/types.svh"
         ]
       },
       "/project/rtl/include/defs.svh": {
         "name": "/project/rtl/include/defs.svh",
         "timestamp": 1699100000,
         "includes": []
       },
       "/project/rtl/include/types.svh": {
         "name": "/project/rtl/include/types.svh",
         "timestamp": 1699100100,
         "includes": ["/project/rtl/include/defs.svh"]
       }
     }
   }

In this example:

- There are two root files: ``top.sv`` and ``dut.sv``
- Both root files include ``defs.svh``
- ``dut.sv`` also includes ``types.svh``
- ``types.svh`` itself includes ``defs.svh`` (creating a shared dependency)
- All files are tracked in ``file_info`` with their paths, timestamps, and includes

Usage in Python
---------------

Loading and saving file collections:

.. code-block:: python

   import json
   from svdep import FileCollection, TaskBuildFileCollection

   # Build and save
   task = TaskBuildFileCollection(root_paths=['top.sv'], incdirs=['include/'])
   collection = task.build()

   with open('deps.json', 'w') as f:
       json.dump(collection.to_dict(), f, indent=2)

   # Load
   with open('deps.json', 'r') as f:
       data = json.load(f)
       collection = FileCollection.from_dict(data)

Compatibility
-------------

Both the pure-Python implementation and the native C++ implementation use the same 
JSON format, ensuring full interoperability. A file collection generated by one 
implementation can be loaded and used by the other.
